

-- Database Schema: E-commerce Database Schema
-- Version: 1.0.0
-- Description: Complete database schema for an e-commerce application
-- Generated by gogenkit

-- Database: ecommerce_db
-- Driver: postgres



-- Table: users
-- System users including customers and administrators
CREATE TABLE users (
    id UUID NOT NULL PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(255) NOT NULL DEFAULT customer,
    is_active BOOLEAN NOT NULL DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL
);


CREATE UNIQUE INDEX idx_users_email_unique ON users(email);

-- Table: categories
-- Product categories for organizing the catalog
CREATE TABLE categories (
    id UUID NOT NULL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    slug VARCHAR(255) NOT NULL UNIQUE,
    description TEXT,
    parent_id UUID,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL
);


CREATE UNIQUE INDEX idx_categories_name_unique ON categories(name);
CREATE UNIQUE INDEX idx_categories_slug_unique ON categories(slug);
CREATE INDEX idx_categories_parent_id ON categories(parent_id);

-- Table: products
-- Product catalog with all available items
CREATE TABLE products (
    id UUID NOT NULL PRIMARY KEY,
    category_id UUID NOT NULL,
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) NOT NULL UNIQUE,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    stock_quantity INTEGER NOT NULL DEFAULT 0,
    sku VARCHAR(255) NOT NULL UNIQUE,
    is_active BOOLEAN NOT NULL DEFAULT true,
    metadata JSONB,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL
);


CREATE INDEX idx_products_category_id ON products(category_id);
CREATE UNIQUE INDEX idx_products_slug_unique ON products(slug);
CREATE UNIQUE INDEX idx_products_sku_unique ON products(sku);

-- Table: orders
-- Customer orders and purchase history
CREATE TABLE orders (
    id UUID NOT NULL PRIMARY KEY,
    user_id UUID NOT NULL,
    order_number VARCHAR(255) NOT NULL UNIQUE,
    status VARCHAR(255) NOT NULL DEFAULT pending,
    total_amount DECIMAL(10,2) NOT NULL,
    shipping_address JSONB NOT NULL,
    billing_address JSONB NOT NULL,
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL
);


CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE UNIQUE INDEX idx_orders_order_number_unique ON orders(order_number);

-- Table: order_items
-- Individual items within customer orders
CREATE TABLE order_items (
    id UUID NOT NULL PRIMARY KEY,
    order_id UUID NOT NULL,
    product_id UUID NOT NULL,
    quantity INTEGER NOT NULL,
    unit_price DECIMAL(10,2) NOT NULL,
    total_price DECIMAL(10,2) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL
);


CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);